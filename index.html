<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¿ãƒƒãƒ—RPG å®Œå…¨ç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{background:#111;color:#fff;font-family:sans-serif;text-align:center;margin:0;padding:20px}
button{font-size:18px;padding:14px 26px;margin:6px}
#tapBtn{font-size:28px;padding:32px 64px;margin-top:20px}
.hidden{display:none!important;pointer-events:none!important}
.boss{font-size:80px}
.player{font-size:60px;margin:10px}
.hp-bar{width:80%;height:20px;background:#444;margin:10px auto;border-radius:10px;overflow:hidden}
.hp{height:100%;background:red}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);
display:flex;justify-content:center;align-items:center;z-index:999;font-size:26px;text-align:center;padding:20px}
.rare{color:#4af}.sr{color:#c6f}.hr{color:#fa4}.ur{color:gold}
.lr{background:linear-gradient(45deg,red,orange,yellow,green,cyan,blue,purple);
-webkit-background-clip:text;color:transparent;font-weight:bold}
</style>
</head>
<body>

<h1>ğŸ”¥ ã‚¿ãƒƒãƒ—RPG ğŸ”¥</h1>

<p>ğŸ’° ã‚³ã‚¤ãƒ³: <span id="coin">0</span></p>
<p>ğŸ’ ãƒ€ã‚¤ãƒ¤: <span id="dia">0</span></p>
<p>âš” æ”»æ’ƒåŠ›: +<span id="atk">0</span></p>

<div class="player" id="player">ğŸ™‚</div>

<button onclick="drawGacha()">ğŸ° ã‚¬ãƒãƒ£ï¼ˆ100ã‚³ã‚¤ãƒ³ï¼‰</button>
<button onclick="drawDiaGacha()">ğŸ’ ä¸Šä½ã‚¬ãƒãƒ£ï¼ˆ1ãƒ€ã‚¤ãƒ¤ï¼‰</button>
<button onclick="exchangeDia()">ğŸ’°1000 â†’ ğŸ’1</button>

<hr>

<div id="select">
<h2>ãƒœã‚¹é¸æŠ</h2>
<button onclick="startBattle('ã‚¹ãƒ©ã‚¤ãƒ ',100,'ğŸŸ¢',10)">ã‚¹ãƒ©ã‚¤ãƒ </button>
<button onclick="startBattle('ã‚ªãƒ¼ã‚¯',300,'ğŸ‘¹',20)">ã‚ªãƒ¼ã‚¯</button>
<button onclick="startBattle('ãƒ‰ãƒ©ã‚´ãƒ³',500,'ğŸ‰',50)">ãƒ‰ãƒ©ã‚´ãƒ³</button>
</div>

<div id="game" class="hidden">
<h2 id="bossName"></h2>
<div class="boss" id="bossIcon"></div>
<div class="hp-bar"><div class="hp" id="hp"></div></div>
<p>HP: <span id="hpText"></span></p>
<button id="tapBtn">ã‚¿ãƒƒãƒ—ï¼</button>
</div>

<div id="overlay" class="overlay hidden"></div>

<script>
/* ===== ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ ===== */
let coin = Number(localStorage.getItem("coin") ?? 0);
let dia  = Number(localStorage.getItem("dia") ?? 0);
let atkBonus = Number(localStorage.getItem("atkBonus") ?? 0);

/* ===== DOM ===== */
const coinEl = document.getElementById("coin");
const diaEl  = document.getElementById("dia");
const atkEl  = document.getElementById("atk");
const overlay = document.getElementById("overlay");

function refresh(){
  coinEl.textContent = coin;
  diaEl.textContent  = dia;
  atkEl.textContent  = atkBonus.toFixed(1);
  localStorage.setItem("coin",coin);
  localStorage.setItem("dia",dia);
  localStorage.setItem("atkBonus",atkBonus);
}
refresh();

/* ===== Overlay ===== */
function showOverlay(t){
  overlay.innerHTML = t + "<br><small>(ã‚¿ãƒƒãƒ—ã§é–‰ã˜ã‚‹)</small>";
  overlay.classList.remove("hidden");
}
overlay.onclick=()=>overlay.classList.add("hidden");

/* ===== ã‚¬ãƒãƒ£ ===== */
function drawGacha(){
  if(coin<100)return showOverlay("ã‚³ã‚¤ãƒ³ä¸è¶³ï¼");
  coin-=100;
  const r=Math.random()*100;
  let add=0.1,name="ãƒ¬ã‚¢";
  if(r<2){add=1.5;name="LR"}
  else if(r<7){add=1;name="UR"}
  else if(r<22){add=0.5;name="HR"}
  else if(r<50){add=0.3;name="SR"}
  atkBonus+=add;
  refresh();
  showOverlay(`âœ¨ ${name} âœ¨<br>æ”»æ’ƒåŠ› +${add}`);
}

/* ===== ãƒ€ã‚¤ãƒ¤ã‚¬ãƒãƒ£ ===== */
function drawDiaGacha(){
  if(dia<1)return showOverlay("ãƒ€ã‚¤ãƒ¤ä¸è¶³ï¼");
  dia--;
  const r=Math.random()*100;
  let add=10,name="ãƒ‡ã‚£ãƒã‚¤ãƒ³";
  if(r<40){add=1.5;name="LR"}
  else if(r<85){add=1;name="UR"}
  atkBonus+=add;
  refresh();
  showOverlay(`ğŸ’ ${name} ğŸ’<br>æ”»æ’ƒåŠ› +${add}`);
}

/* ===== äº¤æ›ï¼ˆå”¯ä¸€ã®æ‰‹å‹•å…¥æ‰‹ï¼‰===== */
function exchangeDia(){
  if(coin<1000)return showOverlay("ã‚³ã‚¤ãƒ³ä¸è¶³ï¼");
  coin-=1000;
  dia+=1;
  refresh();
  showOverlay("ğŸ’ ãƒ€ã‚¤ãƒ¤ +1");
}

/* ===== ãƒãƒˆãƒ« ===== */
let bossHp=0,maxHp=0,reward=0;
function startBattle(n,h,i,r){
  bossHp=maxHp=h;reward=r;
  bossName.textContent=n;
  bossIcon.textContent=i;
  updateHp();
  select.classList.add("hidden");
  game.classList.remove("hidden");
}
function updateHp(){
  hpText.textContent=bossHp;
  hp.style.width=(bossHp/maxHp*100)+"%";
}
tapBtn.onclick=()=>{
  bossHp=Math.max(0,bossHp-(1+atkBonus));
  updateHp();
  if(bossHp===0){
    coin+=reward;
    refresh();
    game.classList.add("hidden");
    select.classList.remove("hidden");
    showOverlay(`ğŸ‰ æ’ƒç ´ï¼<br>ğŸ’° +${reward}`);
  }
};
</script>
</body>
</html>
